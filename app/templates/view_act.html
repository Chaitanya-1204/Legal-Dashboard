{% extends "base.html" %}

{% block title %}{{ act.title }} - Legal Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 md:px-6 py-10">
    
  <div class="bg-white p-6 md:p-8 rounded-lg shadow-md">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 border-b pb-4 mb-4">{{ act.title }}</h1>
    <div class="text-gray-600 mb-6 text-sm">
      <span class="font-semibold">Year:</span> {{ act.year }} |
      <span class="font-semibold">Category:</span> {{ act.category }} |
      <span class="font-semibold">Law Type:</span> {{ act.law_type }}
    </div>

    <!-- expose current doc id for JS to disable self-links -->
    <div class="act-content" data-doc-id="{{ act.doc_id }}">
      {{ act.content | safe }}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const container = document.querySelector('.act-content');
  if (!container) return;

  const currentId = String(container.dataset.docId || '').trim();

  // 1) Disable self-links: /doc/<thisId> or /acts/view/<thisId>
  container.querySelectorAll('a').forEach(a => {
    const hrefAttr = a.getAttribute('href') || '';
    const absHref  = a.href || hrefAttr;

    const mDoc  = hrefAttr.match(/\/doc\/(\d+)(?:[/?#].*)?$/) || absHref.match(/\/doc\/(\d+)(?:[/?#].*)?$/);
    const mView = hrefAttr.match(/\/acts\/view\/(\d+)(?:[/?#].*)?$/) || absHref.match(/\/acts\/view\/(\d+)(?:[/?#].*)?$/);
    const targetId = (mDoc && mDoc[1]) || (mView && mView[1]) || null;

    if (targetId && currentId && String(targetId) === currentId) {
      // make it non-clickable and look like plain text
      a.classList.add('disabled-xref');
      a.removeAttribute('href');
      a.removeAttribute('target');
      a.setAttribute('role', 'text');
      a.addEventListener('click', e => e.preventDefault());
    }
  });

  // 2) Keep your highlight logic (if ?highlight=<id> is present)
  const urlParams = new URLSearchParams(window.location.search);
  const highlightId = urlParams.get('highlight');
  if (highlightId) {
    const target = document.querySelector(`a[href*='/doc/${highlightId}']`);
    const section = target && target.closest('.akn-p, .akn-section, .akn-subsection, .akn-paragraph');
    if (section) {
      section.scrollIntoView({ behavior: 'smooth', block: 'center' });
      section.classList.add('highlight-section');
      setTimeout(() => section.classList.remove('highlight-section'), 3000);
    }
  }
});
</script>

<style>
/* disabled self-links look like normal text */
.disabled-xref { pointer-events: none; text-decoration: none; color: inherit; cursor: default; }
/* optional: subtle highlight visual */
.highlight-section {
  outline: 2px solid rgba(234, 179, 8, 0.8);
  background: rgba(251, 191, 36, 0.08);
  border-radius: 6px;
}
</style>
{% endblock %}
