{% extends "base.html" %}
{% block title %}{{ kind }} — Doc {{ doc_id }}{% endblock %}
{% block content %}
<style>
  :root{
    --ink:#0f172a;--muted:#6b7280;--card:#fff;--border:#e5e7eb;--radius:14px
  }
  .wrap{max-width:1000px;margin:28px auto;padding:0 18px;font-family:Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;color:var(--ink)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;box-shadow:0 1px 2px rgba(16,24,40,.04);margin-bottom:16px}
  .muted{color:var(--muted)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:13px;white-space:pre-wrap;word-break:break-word}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left;vertical-align:top}
  .badge{display:inline-block;padding:2px 6px;border-radius:8px;border:1px solid var(--border);background:#f8fafc;font-size:12px}
  details summary{cursor:pointer}

  /* Box UI (same look as your viewer) */
  .box{
    border:1px solid #e5e7eb;border-radius:14px;padding:16px 18px;margin:18px 0 10px 0;
    line-height:1.9;font-size:17.5px;letter-spacing:.12px;background:#fff;
    box-shadow:inset 0 0 0 2px rgba(203,213,225,.6);
  }
  .para-gap{height:1px;background:#000;margin:10px 0 18px 0;border-radius:0}
</style>

<div class="wrap">
  <header class="card" style="display:flex;justify-content:space-between;align-items:center;gap:12px">
    <div>
      <div style="font-weight:700;font-size:18px">{{ kind }}</div>
      <div class="muted">Document {{ doc_id }}</div>
    </div>
    <div><a href="{{ back_url }}">← Back to document</a></div>
  </header>

  {% if result.error %}
    <div class="card" style="border-left:4px solid #ef4444">
      <strong>Error:</strong> {{ result.error }}
      <div class="muted" style="margin-top:6px">If this mentions OpenNyAI, install it: <code>pip install opennyai</code></div>
    </div>
  {% endif %}

  {# ------------------------- NER VIEW ------------------------- #}
  {% if annotated_html %}
    <div class="card">
      <h3 style="margin:0 0 8px 0">Annotated Text</h3>
      <div style="line-height:1.8">{{ annotated_html|safe }}</div>
    </div>

    {% if ner_entities %}
    <div class="card">
      <h3 style="margin:0 0 8px 0">Entities</h3>
      <table>
        <thead><tr><th>Text</th><th>Label</th><th>Start</th><th>End</th></tr></thead>
        <tbody>
        {% for e in ner_entities %}
          <tr>
            <td>{{ e.text }}</td>
            <td><span class="badge">{{ e.label }}</span></td>
            <td class="muted">{{ e.start }}</td>
            <td class="muted">{{ e.end }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  {% endif %}

  {# ---------------------- SUMMARY VIEW (boxed) ----------------------- #}
  {% if summary_boxes %}
    <div class="card">
      <h3 style="margin:0 0 8px 0">Summary</h3>
      {% for para in summary_boxes %}
        <div class="box">{{ para }}</div>
        {% if not loop.last %}<div class="para-gap"></div>{% endif %}
      {% endfor %}
    </div>
  {% endif %}

  {# ---------------- Rhetorical Roles VIEW -------------------- #}
  {% if rr_sections %}
    <div class="card">
      <h3 style="margin:0 0 8px 0">Rhetorical Roles</h3>
      {% for s in rr_sections %}
        <details open>
          <summary>
            <strong>{{ s.role }}</strong>
            {% if s.confidence is not none %}
              <span class="badge" style="margin-left:8px">confidence: {{ '%.2f' % s.confidence }}</span>
            {% endif %}
          </summary>
          <div style="margin-top:8px;white-space:pre-wrap">{{ s.text }}</div>
        </details>
      {% endfor %}
    </div>
  {% else %}
    <div class="card"><em class="muted">No rhetorical-role spans were returned.</em></div>
  {% endif %}

  {% if debug %}
  <details class="card" open>
    <summary><strong>Raw JSON</strong> <span class="muted">(debug)</span></summary>
    <pre class="mono">{{ result | tojson(indent=2) }}</pre>
  </details>
  {% endif %}
</div>
{% endblock %}
