{% extends "base.html" %}

{% if year %}
  {% set page_title = "Judgments for " ~ year %}
{% elif q %}
  {% set page_title = "Search results for '" ~ q ~ "'" %}
{% else %}
  {% set page_title = "Judgments" %}
{% endif %}

{% block title %}{{ page_title }} - Legal Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 md:px-6 py-10">
  <div class="mb-8 text-sm text-gray-500 flex items-center gap-2">
    <a href="{{ url_for('judgments.years') }}" class="hover:underline">Supreme Court</a>
    {% if year %}<span>›</span><span class="font-semibold">{{ year }}</span>{% endif %}
  </div>

  <h1 class="text-3xl font-bold text-gray-900 mb-6">{{ page_title }}</h1>

  {# --- Filter Bar (Month / Day / Search) --- #}
  {% set msel = request.args.get('month') %}
  {% set dsel = request.args.get('day') %}
  {% set qsel = q or request.args.get('q','') %}

  <form method="get" class="bg-white border border-gray-200 rounded-lg shadow-sm p-4 md:p-5 mb-8 flex flex-wrap items-end gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Month</label>
      <select name="month" class="rounded-md border-gray-300 text-sm">
        <option value="">Any</option>
        <option value="1"  {% if msel=='1' %}selected{% endif %}>Jan</option>
        <option value="2"  {% if msel=='2' %}selected{% endif %}>Feb</option>
        <option value="3"  {% if msel=='3' %}selected{% endif %}>Mar</option>
        <option value="4"  {% if msel=='4' %}selected{% endif %}>Apr</option>
        <option value="5"  {% if msel=='5' %}selected{% endif %}>May</option>
        <option value="6"  {% if msel=='6' %}selected{% endif %}>Jun</option>
        <option value="7"  {% if msel=='7' %}selected{% endif %}>Jul</option>
        <option value="8"  {% if msel=='8' %}selected{% endif %}>Aug</option>
        <option value="9"  {% if msel=='9' %}selected{% endif %}>Sep</option>
        <option value="10" {% if msel=='10' %}selected{% endif %}>Oct</option>
        <option value="11" {% if msel=='11' %}selected{% endif %}>Nov</option>
        <option value="12" {% if msel=='12' %}selected{% endif %}>Dec</option>
      </select>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Day</label>
      <input type="number" name="day" min="1" max="31" class="rounded-md border-gray-300 text-sm w-24" placeholder="Any" value="{{ dsel or '' }}">
    </div>

    <div class="flex-1 min-w-[220px]">
      <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
      <input type="text" name="q" class="w-full rounded-md border-gray-300 text-sm" placeholder="Search title or doc_id" value="{{ qsel }}">
    </div>

    <div class="flex items-center gap-3">
      <button type="submit" class="bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700 transition">Apply</button>
      {% if msel or dsel or qsel %}
        <a class="text-sm text-blue-700 hover:underline" href="{{ url_for('judgments.list_by_year', year=year) }}">Clear</a>
      {% endif %}
    </div>

    <div class="ml-auto text-sm text-gray-600">
      Showing <span class="font-semibold">{{ judgments|length }}</span> results
      {% if msel or dsel or qsel %}
        <span class="ml-2 inline-flex items-center gap-2">
          <span class="px-2 py-0.5 bg-gray-100 rounded">Month: {{ msel or 'Any' }}</span>
          <span class="px-2 py-0.5 bg-gray-100 rounded">Day: {{ dsel or 'Any' }}</span>
          <span class="px-2 py-0.5 bg-gray-100 rounded">Search: {{ qsel or 'None' }}</span>
        </span>
      {% endif %}
    </div>
  </form>

  {# --- Results Grid --- #}
  {% if judgments|length == 0 %}
    <div class="bg-white border border-gray-200 rounded-lg p-10 text-center text-gray-600">
      No judgments match your filters.
    </div>
  {% else %}
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
    {% for j in judgments %}
      {% if j.exists %}
        <a href="{{ url_for('judgments.view', doc_id=j.doc_id) }}" class="block bg-white rounded-lg border border-gray-200 p-5 shadow-sm hover:shadow transition">
          <div class="flex items-start gap-3">
            <i class="fas fa-scale-balanced text-xl pt-1"></i>
            <div>
              <h2 class="text-lg font-semibold text-gray-900">{{ j.title or "Untitled" }}</h2>
              <p class="text-sm text-gray-500">
                {{ j.doc_id }}
                {% if j.month and j.day %} • {{ "%02d"|format(j.day) }}-{{ "%02d"|format(j.month) }}{% elif j.month %} • {{ "%02d"|format(j.month) }}{% endif %}
              </p>
            </div>
          </div>
        </a>
      {% else %}
        <div class="block bg-white rounded-lg border border-gray-200 p-5 shadow-sm opacity-70">
          <div class="flex items-start gap-3">
            <i class="fas fa-scale-balanced text-xl pt-1"></i>
            <div class="flex-1">
              <h2 class="text-lg font-semibold text-gray-900">{{ j.title or "Untitled" }}</h2>
              <p class="text-sm text-gray-500">{{ j.doc_id }}</p>
            </div>
            <span class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-600">File not found</span>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
